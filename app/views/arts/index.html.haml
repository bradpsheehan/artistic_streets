%h1
  =t('headings.discover_art')

.row
  .large-9.columns
    = text_field_tag 'location', nil, placeholder: "#{t('placeholders.map_search')}", id: "address"
  .large-3.columns
    = link_to "FIND", "#", id: "go-to-address", class: "custom-button"
    %br/

.row
  .large-12.large-centered.columns
    #map_canvas

:javascript
  $('#go-to-address').click(function() {

  var address = $('#address').val();

  centerMap(address);

  return false;

  });

:javascript
  var map;
  var geocoder;

  function centerMap() {
    var address = document.getElementById("address").value;
    geocoder.geocode( { 'address': address}, function(results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
        map.setCenter(results[0].geometry.location);
      }
      else {
        alert("Geocode was not successful for the following reason: " + status);
      }
    });
  }

  function initialize() {

    var artObjects = #{art_objects(@arts).to_json};

    geocoder = new google.maps.Geocoder();


    var myLatlng = new google.maps.LatLng(#{@center_point[:lat]}, #{@center_point[:long]})

    var mapOptions = {
      zoom: 13,
      center: myLatlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };

    map = new google.maps.Map(document.getElementById('map_canvas'),
        mapOptions);

        console.log(artObjects.length);

    for (var i = 0; i < artObjects.length; i++) {
      var art = artObjects[i];

      var marker = new google.maps.Marker({
           position: new google.maps.LatLng(art.lat, art.long),
           map: map,
           title: art.title
       });

       marker.contentString = #{info_windows_for_arts(@arts)}[i]

      var infowindow = new google.maps.InfoWindow({
        maxWidth: 400,
      });

      google.maps.event.addListener(marker, 'click', function() {
        infowindow.setContent(this.contentString);
        infowindow.open(map, this);
      });
    }
  }

  google.maps.event.addDomListener(window, 'load', initialize);

